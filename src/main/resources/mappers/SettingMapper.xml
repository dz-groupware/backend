<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.backend.setting.mapper.SettingMapper">

    <!-- 메뉴 설정 페이지 : GNB List 가져오기 -->
    <select id="getGnbList" resultType="com.example.backend.setting.dto.ListRes">
        select id, name, icon_url from menu where id=par_id;
    </select>

    <!-- 메뉴 설정 페이지 : 메뉴 선택 시 메뉴 상세 정보 가져오기 -->
    <select id="getMenuDetailById" resultType="com.example.backend.setting.dto.MenuRes">
        select * from menu where id=1;
    </select>

    <!-- 메뉴 검색 : GNB 선택 결과와 메뉴명 검색 결과 (메뉴트리를 그릴 수 있는 리스트 반환) -->
    <select id="getMenuDetailByName" resultType="com.example.backend.setting.dto.ListRes">
        select coalesce(searchTree.sub, 0) as sub, subTree.id, name, sort_order, par_id, enabled_yn
        from (select id, name, sort_order, name_tree
        from menu where name_tree like #{gnbName})subTree left join
        (select 1 as sub, id, par_id, enabled_yn from menu where name like #{name})searchTree on subTree.id=searchTree.id where sub=1;
    </select>

    <!-- 메뉴 추가 -->
    <insert id="insertMenuById" parameterType="com.example.backend.setting.dto.MenuRes">
        insert into menu(par_id, name, enabled_YN, icon_url, sort_order)
        values(#{parId}, #{name}, #{enabledYN}, #{iconUrl}, #{sortOrder});
    </insert>

    <!-- 메뉴 수정 -->
    <update id="updateMenuById" parameterType="com.example.backend.setting.dto.MenuRes">
        update menu set par_id = #{parId}, name = #{name}, enabledYN = #{enabledYN}, iconUrl = #{iconUrl},
        sortOrder = #{sortOrder}, where id = #{id};
    </update>

    <select id="getIconList" resultType="String">
        select icon_url from menu;
    </select>

    <!-- 즐겨찾기 확인 -->
    <select id="checkFavor">
        select count(*) from favor where emp_id=#{empId} and menu_id=#{menuId};
    </select>

    <!-- 즐겨찾기 추가 -->
    <insert id="FavorOn">
        insert into favor(emp_id, menu_id) values(#{empId}, #{menuId});
    </insert>

    <!-- 즐겨찾기 삭제 -->
    <delete id="FavorOff">
        delete from favor where emp_id=#{empId} and menu_id=#{menuId};
    </delete>

</mapper>